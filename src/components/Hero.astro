---
import Badge from "@/components/Badge.astro"
import LinkedInIcon from "@/components/icons/LinkedIn.astro"
import MailIcon from "@/components/icons/Mail.astro"
import GitHubIcon from "./icons/GitHub.astro"
import SocialPill from "@/components/SocialPill.astro"
import Curriculum from "./icons/Curriculum.astro"

import { portfolioService, type PersonalInfo } from "@/services/PortfolioService"
import { getLangFromUrl, useTranslations } from "@/i18n/utils"

const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang);

// SSR: Obtenemos los datos personales
const personalInfo: PersonalInfo|null = await portfolioService.getPersonalInfo(lang as 'es' | 'en');
const { social, image, name, shortAboutMe } = personalInfo || {};

// Unimos el array shortAboutMe en un solo string
const bioShort = shortAboutMe?.join(" ");
---

<div class="max-w-xl p-4">
  <div class="flex gap-4 mb-4">
    <img
      class="rounded-full shadow-lg size-16 object-cover"
      src={image}
      alt={name}
    />
    <a
      href={social?.linkedin || '#'}
      target="_blank"
      rel="noopener"
      class="flex items-center transition md:justify-center"
    >
      <Badge>{t('hero.badge')}</Badge>
    </a>
  </div>

  <h1
    class="text-4xl font-bold tracking-tight text-gray-800 sm:text-5xl dark:text-white text-balance"
  >
    {t('hero.title')}
  </h1>

  {bioShort && <p
    set:html={bioShort}
    class="
      mt-6
      text-xl
      text-gray-800
      dark:text-gray-300
      
      [&>strong]:text-[#42b883] 
      [&>strong]:font-semibold 
      [&>strong]:underline 
      [&>strong]:decoration-2 
      [&>strong]:underline-offset-4
      [&>strong]:decoration-[#42b883]/40
      dark:[&>strong]:text-[#42b883]
    "
  >
  </p>}

  <nav class="flex flex-wrap gap-2 mt-8">
    <SocialPill href={'https://devthink.vercel.app'}>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M18.75 20H5.25a3.25 3.25 0 0 1-3.245-3.066L2 16.75V6.25a2.25 2.25 0 0 1 2.096-2.245L4.25 4h12.5a2.25 2.25 0 0 1 2.245 2.096L19 6.25V7h.75a2.25 2.25 0 0 1 2.245 2.096L22 9.25v7.5a3.25 3.25 0 0 1-3.066 3.245zH5.25zm-13.5-1.5h13.5a1.75 1.75 0 0 0 1.744-1.607l.006-.143v-7.5a.75.75 0 0 0-.648-.743L19.75 8.5H19v7.75a.75.75 0 0 1-.648.743L18.25 17a.75.75 0 0 1-.743-.648l-.007-.102v-10a.75.75 0 0 0-.648-.743L16.75 5.5H4.25a.75.75 0 0 0-.743.648L3.5 6.25v10.5a1.75 1.75 0 0 0 1.606 1.744zh13.5zm6.996-4h3.006a.75.75 0 0 1 .102 1.493l-.102.007h-3.006a.75.75 0 0 1-.102-1.493zh3.006zm-3.003-3.495a.75.75 0 0 1 .75.75v3.495a.75.75 0 0 1-.75.75H5.748a.75.75 0 0 1-.75-.75v-3.495a.75.75 0 0 1 .75-.75zm-.75 1.5H6.498V14.5h1.995zm3.753-1.5h3.006a.75.75 0 0 1 .102 1.493l-.102.007h-3.006a.75.75 0 0 1-.102-1.494zh3.006zM5.748 7.502h9.504a.75.75 0 0 1 .102 1.494l-.102.006H5.748a.75.75 0 0 1-.102-1.493zh9.504z"/></svg>
      Blog
    </SocialPill>
    {social?.email && <SocialPill href={`mailto:${social.email}`}>
      <MailIcon class="size-4" />
      {t('hero.mail')}
    </SocialPill>}

    {social?.linkedin && <SocialPill href={social.linkedin}>
      <LinkedInIcon class="size-4" />
      LinkedIn
    </SocialPill>}

    {social?.github && <SocialPill href={social.github}>
      <GitHubIcon class="size-4" />
      Github
    </SocialPill>}

    <SocialPill 
      download={`CV_Joan_Matias_${lang.toUpperCase()}`} 
      href={`/joan_cv_${lang || 'es'}.pdf`}
    >
      <Curriculum class="size-4" />
      CV
    </SocialPill>
  </nav>
</div>
